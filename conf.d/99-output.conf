# =============================================================================
# 99-output.conf - Elasticsearch Output
# Index nomlari:
#   - winlogbeat-YYYY.MM.dd
#   - auditbeat-YYYY.MM.dd
#   - metricbeat-YYYY.MM.dd
#   - heartbeat-YYYY.MM.dd
#   - packetbeat-YYYY.MM.dd
#   - filebeat-manba-tur-YYYY.MM.dd (masalan: filebeat-nginx-access-2024.01.15)
# =============================================================================

output {
  elasticsearch {
    hosts => ["${ES_HOSTS}"]
    user => "${ES_USER}"
    password => "${ES_PASSWORD}"
    
    # SSL sozlamalari - ishlab chiqarishda yoqing
    # ssl_enabled => true
    # ssl_certificate_authorities => ["/usr/share/logstash/certs/ca.crt"]
    
    # Dinamik index nomi - 05-routing.conf da o'rnatiladi
    index => "%{[@metadata][target_index]}"

    data_stream => false
    ilm_enabled => false

    # ECS muvofiqligi
    ecs_compatibility => v8

    # Ishonchlilik uchun qayta urinish sozlamalari
    retry_on_conflict => 3

    # Shablon boshqaruvi - Beats templatelari o'zi boshqaradi
    manage_template => false
  }

  # Debug chiqishi - nosozlik bartaraf etish uchun izoh olib tashlang
  # Bu yerda agent_id va agent_token ko'rinadi
  # stdout {
  #   codec => rubydebug {
  #     metadata => true
  #   }
  # }
}
