# =============================================================================
# 99-output.conf - UpDive indeks nomlanishi bilan Elasticsearch chiqishi
# Docker versiyasi
# =============================================================================

output {
  # Agent turiga qarab Elasticsearch'ga yo'naltirish
  
  elasticsearch {
    hosts => ["${ES_HOSTS}"]
    user => "${ES_USER}"
    password => "${ES_PASSWORD}"
    
    # SSL sozlamalari - ishlab chiqarishda yoqing
    # ssl_enabled => true
    # ssl_certificate_authorities => ["/usr/share/logstash/certs/ca.crt"]
    
    # Agar filtrda target_index o'rnatilgan bo'lsa shuni oladi, aks holda default
    if [@metadata][target_index] {
      index => "%{[@metadata][target_index]}"
    } else {
      index => "updive-%{[@metadata][updive_type]}-%{+YYYY.MM.dd}"
    }

    data_stream => false
    ilm_enabled => false

    # ECS muvofiqligi
    ecs_compatibility => v8

    # Ishonchlilik uchun qayta urinish sozlamalari
    retry_on_conflict => 3

    # Shablon boshqaruvi
    manage_template => false
  }

  # Debug chiqishi - nosozlik bartaraf etish uchun izoh olib tashlang
  # stdout {
  #   codec => rubydebug {
  #     metadata => true
  #   }
  # }
}
